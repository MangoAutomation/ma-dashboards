<h2>Overview</h2>

<p>
    Event handlers enable the user to define the behavior of the system against the triggering of an event. 
    Events can be triggered due to various conditions. When this happens, associated event handlers are executed.
</p>

<p>
    There are two types of event handlers:
</p>

<ul>
    <li><b>Notifications (email):</b> send email to a list</li>
    <li><b>Set point:</b> write values ​​in data points (which must be configured as setpoints)</li>
</ul>

<h2>Editing Notifications</h2>

<p>
    To add a mailing list to a list of recipients, select it from the list of add recipients and click. To add a user, 
    select a user from the Add user list and click. To add another address, enter it in the add address field and press <b>Enter</b>. 
    To delete any recipients from the list, click <b>x</b> button.
</p>

<p>
    To have escalation emails sent, select the Send escalation field, and enter Escalation recipients. The escalation email will only be 
    sent if the associated event is active for the period Escalate if active for
</p>

<p>
    An inactive notification event can be sent selected in the Send inactive notification field. If selected, notification will 
    be sent to all event receivers once the event has become inactive. Note that if an escalation email was not sent, inactive 
    notification will not be sent to the escalation list. Only those recipients who have received an active notification will 
    receive an inactive notification.
</p>

<h2>Editing Set Points</h2>

<p>
    When an event is triggered, this handler will write the value at a given data point. The target is the data point that 
    will have its value changed. Optionally, the data point can be set with the value that changed the event, but this is only 
    possible if the event was triggered by a value changer, and the path data type is the same as the source data type. To set 
    the path to the source value, select the Use source value field. Or, enter the value you want to write in the Value to set field.
</p>

<h2>Custom Email Templates</h2>

<p>
    Email templates are generated using FreeMarker <a href="https://freemarker.apache.org/">FreeMarker</a>. Mango can generate HTML or Plain text emails, this is configured 
    in the Email system settings area. Using the FreeMarker language one can customize the templates located at <code>MA_HOME/ftl</code>, if 
    you choose to customize an existing template be sure to place it into the <code>overrides/ftl/...</code> directory in the same folder structure as 
    the original. Further to the standard FreeMarker language there are 2 additional directives specific to Mango.
</p>

<ul>
    <li>
        <code><@subject>email subject content< /@subject></code> - Defines the subject
    </li>
    <li>
        <code><@fmt message=translatable message OR key=i18n key/></code> - allows the use of Mango's i18n translations
    </li>
</ul>

<h3>Model</h3>

<p>
    The model is a map of data sent into the template that allows accessing Mango specific information during template generation. To use something 
    from the model, use ${modelKey} and/or ${modelKey.property}. For example every Email generated by and event handler will have an 'evt' property. 
    For example you can use ${evt.alarmLevel} to get the integer value of the alarm level. For example to Print Urgent one could use the following 
    ftl code:
</p>

<p>
    <code><#if evt.alarmLevel==0> <@fmt key="common.alarmLevel.urgent"/> < /#if></code>
</p>

<p>Another example of adding data point tags:</p>

<p><code><#list point.tags as tag,value> ${tag} - ${value} < /#list></code></p>

<p>
    Describing how to use all of the data within the model is not within the scope of this document, for examples please see the existing templates in the ftl folder.
</p>