<md-input-container ng-if="!$ctrl.editMode && !$ctrl.selectMultiple" md-no-float="$ctrl.noFloat" flex>
    <label ng-if="!$ctrl.noFloat" ng-transclude="label"><span ma-tr="ui.components.selectTagValue" ma-tr-args="[$ctrl.key]"></span></label>
    <md-select ng-attr-md-selected-text="{{$ctrl.selectedText && '$ctrl.selectedText'}}"
            ng-model="$ctrl.selected" ng-change="$ctrl.inputChanged()"
            md-on-open="$ctrl.doQuery()" ma-form-exclude>
        <md-option ng-if="$ctrl.showAnyOption" ng-value="undefined" md-option-empty><em ma-tr="ui.app.any"></em></md-option>
        <md-option ng-repeat="value in $ctrl.values" ng-value="value">
            <em ng-if="value === null" ma-tr="ui.components.noTagKey" ma-tr-args="[$ctrl.key]"></em>
            <span ng-if="value !== null" ng-bind="value"></span>
        </md-option>
    </md-select>
</md-input-container>
<md-input-container ng-if="!$ctrl.editMode && $ctrl.selectMultiple" md-no-float="$ctrl.noFloat" flex>
    <label ng-if="!$ctrl.noFloat" ng-transclude="label"><span ma-tr="ui.components.selectTagValue" ma-tr-args="[$ctrl.key]"></span></label>
    <md-select ng-attr-md-selected-text="{{$ctrl.selectedText && '$ctrl.selectedText'}}" multiple="true"
            ng-model="$ctrl.selected" ng-change="$ctrl.inputChanged()" ng-model-options="{trackBy: '$value'}"
            md-on-open="$ctrl.doQuery()" ma-form-exclude>
        <md-option ng-repeat="value in $ctrl.values" ng-value="value">
            <em ng-if="value === null" ma-tr="ui.components.noTagKey" ma-tr-args="[$ctrl.key]"></em>
            <span ng-if="value !== null" ng-bind="value"></span>
        </md-option>
    </md-select>
</md-input-container>

<md-autocomplete ng-if="$ctrl.editMode" flex
        md-selected-item="$ctrl.selected"
        md-selected-item-change="$ctrl.inputChanged()"
        md-search-text="$ctrl.searchText"
        md-search-text-change="$ctrl.searchTextChanged()"
        md-items="value in $ctrl.doSearch()"
        md-item-text="value"
        md-no-cache="::true"
        md-min-length="0"
        md-floating-label="{{$ctrl.labelText || ('ui.components.enterTagValue' | maTr:[$ctrl.key])}}"
        md-delay="0"
        md-select-on-match="::true"
        md-escape-options="blur"
        md-clear-button="::true"
        ng-blur="$ctrl.autocompleteBlurred()">
    <md-item-template>
        <span md-highlight-text="$ctrl.searchText" md-highlight-flags="gi">{{value}}</span>
    </md-item-template>
</md-autocomplete>