<div ng-form="$ctrl.form" ng-disabled="$ctrl.savePromise" ma-validation-messages="$ctrl.validationMessages" flex="noshrink" layout="column">
    <md-tabs flex="noshrink" layout="column" ng-attr-md-dynamic-height="{{$ctrl.dynamicHeight}}" md-border-bottom="true" md-swipe-content="false" md-selected="$ctrl.activeTab">
        <md-tab>
            <md-tab-label>
                <span ma-tr="ui.app.dataPoint"></span>
            </md-tab-label>
            <md-tab-body>
                <div class="md-padding ma-no-padding-bottom">
                    <div layout="row" layout-wrap layout-align="space-between start" class="ma-inputs-container">
                        
                        <div flex="100" flex-gt-md="50">
                            <md-switch name="enabled" ng-model="$ctrl.dataPoint.enabled"><span ma-tr="common.enabled"></span></md-switch>
                        </div>

                        <md-input-container flex="100" flex-gt-md="50">
                            <md-icon>settings</md-icon>
                            <label ma-tr="dsEdit.dataPointType"></label>
                            <md-select name="dataSourceTypeName" ng-model="$ctrl.dataPoint.dataSourceTypeName"
                                    ng-disabled="$ctrl.fixedType || !$ctrl.dataPoint.isNew()" required>
                                <md-option ng-repeat="type in $ctrl.types track by type.type" ng-value="type.type">
                                    <span ma-tr="{{type.description}}"></span>
                                </md-option>
                            </md-select>
                            <div ng-messages="$ctrl.form.dataSourceTypeName.$error">
                                <div ng-message="required" ma-tr="ui.app.required"></div>
                                <div ng-message="validationMessage" ng-bind="$ctrl.form.dataSourceTypeName.validationMessage"></div>
                            </div>
                        </md-input-container>
                
                        <md-input-container flex="100" flex-gt-md="50">
                            <md-icon>label</md-icon>
                            <label ma-tr="common.xid"></label>
                            <input name="xid" ng-model="$ctrl.dataPoint.xid" required ng-disabled="$ctrl.dataPoint.xid.hasMultipleValues()">
                            <div ng-messages="$ctrl.form.xid.$error">
                                <div ng-message="required" ma-tr="ui.app.required"></div>
                                <div ng-message="validationMessage" ng-bind="$ctrl.form.xid.validationMessage"></div>
                            </div>
                        </md-input-container>

                        <md-input-container flex="100" flex-gt-md="50">
                            <md-icon>label</md-icon>
                            <label ma-tr="common.name"></label>
                            <input name="name" ng-model="$ctrl.dataPoint.name" required>
                            <div ng-messages="$ctrl.form.name.$error">
                                <div ng-message="required" ma-tr="ui.app.required"></div>
                                <div ng-message="validationMessage" ng-bind="$ctrl.form.name.validationMessage"></div>
                            </div>
                        </md-input-container>
                
                        <md-input-container flex="100" flex-gt-md="50">
                            <md-icon>device_hub</md-icon>
                            <label ma-tr="common.deviceName"></label>
                            <input name="deviceName" ng-model="$ctrl.dataPoint.deviceName">
                            <div ng-messages="$ctrl.form.deviceName.$error">
                                <div ng-message="validationMessage" ng-bind="$ctrl.form.deviceName.validationMessage"></div>
                            </div>
                        </md-input-container>
                
                        <md-input-container flex="100" flex-gt-md="50" ng-click="$ctrl.activeTab = 2">
                            <md-icon>local_offer</md-icon>
                            <label ma-tr="ui.app.tags"></label>
                            <input ng-model="$ctrl.dataPoint.tagsString" ng-disabled="true">
                        </md-input-container>

                        <md-input-container flex="100" flex-gt-md="50">
                            <md-icon>lock</md-icon>
                            <label ma-tr="pointEdit.props.permission.read"></label>
                            <input name="readPermission" ng-model="$ctrl.dataPoint.readPermission" pattern="^\s*[\w-]+?\s*(,\s*[\w-]+?\s*)*$">
                            <div ng-messages="$ctrl.form.readPermission.$error">
                                <div ng-message="pattern" ma-tr="ui.app.invalidPermissions"></div>
                                <div ng-message="validationMessage" ng-bind="$ctrl.form.readPermission.validationMessage"></div>
                            </div>
                            <ma-permissions-menu ng-model="$ctrl.dataPoint.readPermission" ma-flatten-values="null" ng-disabled="$ctrl.dataPoint.readPermission.hasMultipleValues()"></ma-permissions-menu>
                        </md-input-container>

                        <md-input-container flex="100" flex-gt-md="50">
                            <md-icon>lock</md-icon>
                            <label ma-tr="pointEdit.props.permission.set"></label>
                            <input name="setPermission" ng-model="$ctrl.dataPoint.setPermission" pattern="^\s*[\w-]+?\s*(,\s*[\w-]+?\s*)*$">
                            <div ng-messages="$ctrl.form.setPermission.$error">
                                <div ng-message="pattern" ma-tr="ui.app.invalidPermissions"></div>
                                <div ng-message="validationMessage" ng-bind="$ctrl.form.setPermission.validationMessage"></div>
                            </div>
                            <ma-permissions-menu ng-model="$ctrl.dataPoint.setPermission" ma-flatten-values="null" ng-disabled="$ctrl.dataPoint.setPermission.hasMultipleValues()"></ma-permissions-menu>
                        </md-input-container>
                        
                    </div>

                    <div ng-include="$ctrl.typesByName[$ctrl.dataPoint.dataSourceTypeName].templateUrl"></div>
                </div>
            </md-tab-body>
        </md-tab>
        <md-tab>
            <md-tab-label>
                <span ma-tr="pointEdit.props.props"></span>
            </md-tab-label>
            <md-tab-body>
                <div class="md-padding ma-no-padding-bottom">
                    <div layout="row" layout-wrap layout-align="space-between start" class="ma-inputs-container">
                        <md-input-container flex="100" flex-gt-md="50" ng-if="$ctrl.dataPoint.dataType === 'NUMERIC'">
                            <md-icon>straighten</md-icon>
                            <label ma-tr="pointEdit.props.unit"></label>
                            <input name="unit" ng-model="$ctrl.dataPoint.unit">
                            <div ng-messages="$ctrl.form.unit.$error">
                                <div ng-message="validationMessage" ng-bind="$ctrl.form.unit.validationMessage"></div>
                            </div>
                        </md-input-container>
                        
                        <div flex="100" flex-gt-md="50" layout layout-align="start center">
                            <ma-color-picker ng-model="$ctrl.dataPoint.chartColour" ma-flatten-values="$values.firstNonEmpty()"></ma-color-picker>
                            <md-input-container flex>
                                <label ma-tr="pointEdit.props.chartColour"></label>
                                <input name="chartColour" ng-model="$ctrl.dataPoint.chartColour">
                                <div ng-messages="$ctrl.form.chartColour.$error">
                                    <div ng-message="validationMessage" ng-bind="$ctrl.form.chartColour.validationMessage"></div>
                                </div>
                            </md-input-container>
                        </div>
                    </div>
                </div>
            </md-tab-body>
        </md-tab>
        <md-tab>
            <md-tab-label>
                <span ma-tr="ui.app.tags"></span>
            </md-tab-label>
            <md-tab-body>
                <div class="md-padding ma-no-padding-bottom">
                    <ma-data-point-tags-editor name="tags" ng-model="$ctrl.dataPoint.tags"></ma-data-point-tags-editor>
                </div>
            </md-tab-body>
        </md-tab>
        <md-tab>
            <md-tab-label>
                <span ma-tr="pointEdit.logging.props"></span>
            </md-tab-label>
            <md-tab-body>
                
            </md-tab-body>
        </md-tab>
        <md-tab>
            <md-tab-label>
                <span ma-tr="pointEdit.text.props"></span>
            </md-tab-label>
            <md-tab-body>
                
            </md-tab-body>
        </md-tab>
        <md-tab>
            <md-tab-label>
                <span ma-tr="pointEdit.chart.props"></span>
            </md-tab-label>
            <md-tab-body>
                
            </md-tab-body>
        </md-tab>
        <md-tab>
            <md-tab-label>
                <span ma-tr="pointEdit.purge.purgeNow"></span>
            </md-tab-label>
            <md-tab-body>
                
            </md-tab-body>
        </md-tab>
    </md-tabs>

    <div class="md-padding" ng-if="$ctrl.form.validationMessage" ng-bind="$ctrl.form.validationMessage" role="alert" md-colors="::{color: 'warn'}"></div>

    <div ng-if="$ctrl.bulkTask" class="md-padding ma-action-buttons">
        <div layout layout-align="center">
            <em>
                <span ng-bind="$ctrl.bulkTask.progress || 0"></span>% (<span ma-tr="ui.app.pointXofX" ma-tr-args="[$ctrl.bulkTask.position || 0, $ctrl.bulkTask.maximum || 0]"></span>)
            </em>
        </div>
        
        <md-progress-linear md-mode="determinate" ng-value="$ctrl.bulkTask.progress"></md-progress-linear>
        
        <md-button class="md-raised md-warn" ng-click="$ctrl.bulkTask.cancel()">
            <md-icon>cancel</md-icon>
            <span ma-tr="ui.app.cancelBulkEdit"></span>
        </md-button>
    </div>

    <div ng-if="!$ctrl.bulkTask" class="md-padding ma-action-buttons">
        <md-button class="md-raised md-primary" ng-click="$ctrl.saveItem($event)" ng-disabled="!$ctrl.form || $ctrl.savePromise">
            <md-icon>save</md-icon>
            <span ma-tr="common.save"></span>
        </md-button>
        <md-button class="md-raised" ng-click="$ctrl.revertItem($event)" ng-disabled="$ctrl.form.$pristine || $ctrl.savePromise">
            <md-icon>undo</md-icon>
            <span ma-tr="ui.app.revert"></span>
        </md-button>
        <md-button class="md-raised md-warn" ng-click="$ctrl.deleteItem($event)" ng-disabled="$ctrl.dataPoint.isNew() || $ctrl.savePromise" ng-if="!$ctrl.points">
            <md-icon>delete</md-icon>
            <span ma-tr="common.delete"></span>
        </md-button>
        <em ng-if="$ctrl.errorMessages.length" md-colors="::{color: 'warn'}">
            <span ng-repeat="msg in $ctrl.errorMessages"><span ng-bind="msg"></span><span ng-if="!$last">, </span></span>
        </em>
    </div>
</div>
