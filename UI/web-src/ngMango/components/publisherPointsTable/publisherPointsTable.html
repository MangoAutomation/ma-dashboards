<md-input-container class="ma-publisher-points-selector">
    <ma-drop-down-button>
        <span ma-tr="ui.publisher.pointsSelected" ma-tr-args="[$ctrl.publishedPointsCount]"></span>
        <ma-drop-down create-on-init="false" class="ma-slide-down" on-close="$ctrl.pointSelectorClosed()">
            <ma-data-point-selector select-multiple="::true" class="ma-publisher-editor"
                ng-model="$ctrl.pointsToPublishArr" ng-change="$ctrl.pointsChanged()"
                ma-parse-value="$ctrl.pointsToPublisherPoints($value)"
                ma-format-value="$ctrl.publisherPointsToPoints($value)">
            </ma-data-point-selector>
        </ma-drop-down>
    </ma-drop-down-button>
</md-input-container>

<div ng-form="publisherPointsTable" ma-form-exclude class="ma-virtual-repeat-table-container">
    <div class="ma-virtual-repeat-table">
        <div class="ma-virtual-repeat-table-header">
            <div class="ma-virtual-repeat-table-row">
                <div class="ma-actions-column">
                    <md-menu-bar>
                        <md-menu md-offset="-4 4">
                            <md-button class="md-icon-button ma-small-button ma-no-margin"
                                ng-click="$ctrl.openMenu($event, $mdMenu)" tabindex="2">
                                <md-icon md-menu-origin>more_vert</md-icon>
                                <md-tooltip><span ma-tr="ui.app.moreOptions"></span></md-tooltip>
                            </md-button>
                            <md-menu-content width="3" class="ma-data-point-selector"
                                md-colors="::{background: 'background-hue-2'}">
                                <md-menu-item>
                                    <md-button
                                        ng-click="$ctrl.showFilters = !$ctrl.showFilters; $ctrl.showFiltersChanged()">
                                        <md-checkbox ng-click="$event.stopPropagation()" ng-model="$ctrl.showFilters"
                                            ng-change="$ctrl.showFiltersChanged()">
                                            <span ma-tr="ui.app.showFilters"></span>
                                        </md-checkbox>
                                    </md-button>
                                </md-menu-item>

                                <md-menu-item>
                                    <md-menu>
                                        <md-button ng-click="$mdMenu.open($event)"><span
                                                ma-tr="ui.app.selectColumns"></span></md-button>
                                        <md-menu-content width="3" class="ma-data-point-selector ma-checkbox-menu"
                                            md-colors="::{background: 'background-hue-2'}">
                                            <md-menu-item
                                                ng-repeat="column in $ctrl.nonTagColumns track by column.name">
                                                <md-button ng-init="model = $ctrl.getSelectedColumnsModel(column)"
                                                    ng-click="model.value = !model.value; $ctrl.selectedColumnsChanged()"
                                                    md-prevent-menu-close
                                                    ng-disabled="model.value && $ctrl.selectedColumns.length === 1">
                                                    <md-checkbox ng-click="$event.stopPropagation()"
                                                        md-prevent-menu-close md-no-ink="true" ng-model="model.value"
                                                        ng-change="$ctrl.selectedColumnsChanged()"
                                                        ng-disabled="model.value && $ctrl.selectedColumns.length === 1">
                                                        <span ng-if="!column.labelArgs" ma-tr="{{column.label}}"></span>
                                                        <span ng-if="column.labelArgs" ma-tr="{{column.label}}"
                                                            ma-tr-args="column.labelArgs"></span>
                                                    </md-checkbox>
                                                </md-button>
                                            </md-menu-item>
                                        </md-menu-content>
                                    </md-menu>
                                </md-menu-item>
                            </md-menu-content>
                        </md-menu>
                    </md-menu-bar>

                </div>
                <div ng-repeat="column in $ctrl.selectedColumns | orderBy:'order' track by column.name"
                    ng-click="column.sortable && $ctrl.sortBy(column)" tabindex="1" class="{{column.class}}">
                    <span ma-tr="{{column.label}}" ma-tr-args="column.labelArgs"></span>
                    <md-icon class="ma-sort-icon ma-disable-animate"
                        ng-if="column.sortable && $ctrl.sort[0].columnName === column.name"
                        ng-class="{'ma-sort-descending': $ctrl.sort[0].descending}">arrow_upward</md-icon>
                </div>
            </div>
            <div class="ma-virtual-repeat-table-row" ng-if="$ctrl.showFilters" class="ma-filter-header">
                <div class="ma-buttons-column"></div>
                <div ng-repeat="column in $ctrl.selectedColumns | orderBy:'order' track by column.name">
                    <md-input-container md-no-float="true" ng-if="column.filterable">
                        <input ng-model="column.filter" ng-model-options="{debounce: 1000}"
                            ng-change="$ctrl.filterChanged()" ma-tr="ui.app.filter">
                        <md-button ng-show="!!column.filter" class="ma-input-button md-icon-button"
                            ng-click="column.filter = null; $ctrl.filterChanged()">
                            <md-icon>clear</md-icon>
                        </md-button>
                    </md-input-container>
                </div>
            </div>
            <md-progress-linear ng-show="$ctrl.itemsPromise" md-mode="indeterminate"></md-progress-linear>
        </div>
        <div ng-if="$ctrl.pages.$total === 0 && !$ctrl.itemsPromise" class="ma-no-items-to-list"
            ma-tr="ui.publisher.noPointsSelected"></div>
        <div class="ma-virtual-repeat-table-body" md-virtual-repeat-container>
            <div class="ma-virtual-repeat-table-row ma-item-row" md-virtual-repeat="item in $ctrl" md-on-demand
                ng-class="{'ma-row-loading': item == null, 'ma-item-selected': $ctrl.selectedItems.has(item.xid)}">
                <!-- ng-click="$ctrl.rowClicked({$event: $event, $item: item, $index: $index, $tableCtrl: $ctrl})" -->
                <div class="ma-actions-column">
                    <md-button class="md-icon-button ma-small-button"
                        ng-click="$ctrl.removePoint({$event , item, $index})">
                        <md-icon>highlight_off</md-icon>
                    </md-button>
                </div>

                <div ng-repeat="column in $ctrl.selectedColumns | orderBy:'order' track by column.name"
                    class="{{column.class}}">
                    <span ng-if="column.name !== 'enabled' && !column.editorTemplateUrl && !column.editable"
                        ng-class="{'ma-empty-null': $ctrl.getCellValue(item, column) == null}"
                        ng-bind="$ctrl.getCellValue(item, column) | maDisplayNull"></span>

                    <md-input-container flex
                        ng-if="column.name !== 'enabled' && !column.editorTemplateUrl && column.editable">
                        <input ng-model="item[column.name]">
                    </md-input-container>

                    <md-checkbox class="ma-pp-enabled-cell"
                        ng-if="column.name === 'enabled' && !column.editorTemplateUrl" ng-model="item.enabled"
                        ng-change="$ctrl.updatePoint({$event, item})"></md-checkbox>

                    <span ng-if="column.name !== 'enabled' && column.editorTemplateUrl"
                        ng-include="column.editorTemplateUrl"></span>
                </div>
            </div>
        </div>
    </div>
</div>
<div layout="column" ng-if="$ctrl.dropDownCtrl.fullscreen && $ctrl.selectMultiple">
    <md-button ng-click="$ctrl.dropDownCtrl.close()">
        <span ma-tr="common.ok"></span>
    </md-button>
</div>

<div class="md-padding" ng-if="$ctrl.form.validationMessage" ng-bind="$ctrl.form.validationMessage" role="alert"
    class="ma-error-text"></div>

<div ng-if="$ctrl.bulkTask" class="md-padding ma-action-buttons">
    <div layout layout-align="center">
        <em>
            <span ng-bind="$ctrl.bulkTask.progress || 0"></span>% (<span ma-tr="ui.app.pointXofX"
                ma-tr-args="[$ctrl.bulkTask.position || 0, $ctrl.bulkTask.maximum || 0]"></span>)
        </em>
    </div>

    <md-progress-linear md-mode="determinate" ng-value="$ctrl.bulkTask.progress"></md-progress-linear>

    <md-button class="md-raised md-warn" ng-click="$ctrl.bulkTask.cancel()">
        <md-icon>cancel</md-icon>
        <span ma-tr="ui.app.cancelBulkEdit"></span>
    </md-button>
</div>

<div ng-if="$ctrl.errorMessages.length" class="md-padding">
    <em class="ma-error-text">
        <span ng-repeat="msg in $ctrl.errorMessages">
            <span ng-bind="msg"></span>
            <span ng-if="!$last">,</span>
            <br>
        </span>
    </em>
</div>

<div class="ma-action-buttons">
    <md-button class="md-raised md-primary" ng-click="$ctrl.savePoints($event)">
        <md-icon>save</md-icon>
        <span ma-tr="ui.app.startBulkEdit"></span>
    </md-button>
</div>