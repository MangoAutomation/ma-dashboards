<ma-watch-list-select ng-model="$ctrl.watchList" ng-change="$ctrl.watchListChanged()" watch-list-xid="WL_ac76beaa-10f4-40f0-b714-d0fda1c1e801"></ma-watch-list-select>

<ma-bulk-data-point-tasks all-users="true"></ma-bulk-data-point-tasks>

<div>
    <md-input-container>
        <label>Set permission</label>
        <input ng-model="$ctrl.setPermission" ng-change="$ctrl.setSetPermission()">
    </md-input-container>
    <md-input-container>
        <label>Tag val</label>
        <input ng-model="$ctrl.tagVal">
    </md-input-container>
    
    <md-button class="md-raised" ng-click="$ctrl.start($event)" ng-disabled="!$ctrl.selectedPoints.length || !$ctrl.updateBody">Start</md-button>
</div>

<md-input-container>
    <label>Select columns</label>
    <md-select multiple="true" ng-model="$ctrl.selectedColumns" ng-model-options="{trackBy: '$value.name'}">
        <md-option ng-repeat="column in $ctrl.columns track by column.name" ng-value="column" ng-disabled="column.disabled"><span ng-bind="column.label"></span></md-option>
    </md-select>
</md-input-container>

<md-input-container>
    <label>Select tag columns</label>
    <md-select multiple="true" ng-model="$ctrl.selectedTags" ng-model-options="{trackBy: '$value.name'}">
        <md-option ng-repeat="tag in $ctrl.availableTags track by tag.name" ng-value="tag"><span ng-bind="tag.label"></span></md-option>
    </md-select>
</md-input-container>

<div>
    <md-input-container>
        <label>Tag column</label>
        <input ng-model="$ctrl.tagColumnToAdd">
    </md-input-container>
    
    <md-button class="md-raised" ng-click="$ctrl.addTagColumn($event)" ng-disabled="$ctrl.bulkTaskPromise || $ctrl.pointsPromise">Add tag column</md-button>
</div>

<div layout layout-align="start end">
    <md-checkbox aria-label="Select all" class="ma-select-all-checkbox" ng-model="$ctrl.selectAll" ng-change="$ctrl.selectAllChanged()"
            ng-disabled="$ctrl.bulkTaskPromise || $ctrl.pointsPromise" md-indeterminate="$ctrl.selectAllIndeterminate">
    </md-checkbox>
    <div flex></div>
    <md-table-pagination md-limit="$ctrl.numberOfRows" md-limit-options="[10, 15, 25, 50, 100, 200]" md-page="$ctrl.pageNumber" md-page-select md-total="{{$ctrl.points.length}}"></md-table-pagination>
</div>
<md-table-container>
    <table md-table md-row-select multiple ng-model="$ctrl.selectedPoints" md-progress="$ctrl.pointsPromise" class="ma-no-select-all">
        <thead md-head md-order="$ctrl.tableOrder">
            <tr md-row>
                <th ng-repeat="column in $ctrl.selectedColumns track by column.name" md-column md-order-by="{{column.sortable ? column.name : ''}}">
                    <span ng-bind="column.label"></span>
                </th>
                <th ng-repeat="tag in $ctrl.selectedTags track by tag.name" md-column>
                    <span ng-bind="tag.label"></span>
                    <md-button class="md-icon-button" ng-click="$ctrl.setTag(tag)"><md-icon>edit</md-icon></md-button>
                    <md-button class="md-icon-button" ng-click="$ctrl.removeTag(tag)"><md-icon>delete</md-icon></md-button>
                </th>
            </tr>
        </thead>
        <tbody md-body>
            <tr md-row ng-repeat="point in $ctrl.points | orderBy: $ctrl.tableOrder | limitTo: $ctrl.numberOfRows: ($ctrl.pageNumber - 1) * $ctrl.numberOfRows track by point.xid"
                    ng-disabled="$ctrl.bulkTaskPromise || $ctrl.pointsPromise"
                    md-select="point"
                    md-select-id="xid"
                    md-on-select="$ctrl.selectedPointsChangedBound"
                    md-on-deselect="$ctrl.selectedPointsChangedBound"
                    md-colors="{background: $ctrl.results[$index].error ? 'warn' : 'background'}">
                <td ng-repeat="column in $ctrl.selectedColumns track by column.name" md-cell ng-bind="point[column.name]"></td>
                <td ng-repeat="tag in $ctrl.selectedTags track by tag.name" md-cell ng-bind="point.tags[tag.name]"></td>
            </tr>
        </tbody>
    </table>
</md-table-container>
