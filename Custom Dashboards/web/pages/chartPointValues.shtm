<!DOCTYPE html>
<html>
    <head>
        <title>Default Dashboard</title>
        
        
        <!-- Page Style -->
        <style type="text/css">
        </style>
        
        <!-- Scripts from Module Directory -->
        <script type="text/javascript" src="/modules/mangoApi/web/js/jquery/jquery-1.11.1.js"></script>
        <!-- Charting Library -->
        <script type="text/javascript" src="/modules/mangoApi/web/js/amcharts/amcharts.js"></script>
        <script type="text/javascript" src="/modules/mangoApi/web/js/amcharts/serial.js"></script>
        <!-- Mango Rest API Helper -->
        <script type="text/javascript" src="/modules/mangoApi/web/js/mangoApi.js"></script>         
       
        <script type="text/javascript">
          var chart,chartCursor,chartData,graph; //Chart Globals
          
          //Configure the settings
          var pointXid = "DP_544063"; //Data point xid to chart
          var numberOfSamples = 500; //Number of previous point values to chart (Will change to date range when the API tested further)
          
          /**
           * Run on page load
           */
          $( document ).ready(function(){

            //Load in the graph with the latest point values
            mangoRest.pointValues.getLatest(pointXid, numberOfSamples, function(data){
                  $('#pointValueCount').text(data.length + " " + " samples");

                  //TODO Deal with dates better in response
                  // Format data and re-order the values the way AM charts expects
                  chartData = new Array();
                  for(var i=data.length-1; i>=0; i--){
                      chartData.push({
                        date: data[i].time,
                        value: data[i].value
                      });
                  }
                  createSerialChart(chartData);
                  
              }, function(jqXHR, textStatus, errorThrown, mangoMessage){
                  //alert user on fail
                  alert(errorThrown + " " + mangoMessage);
              });
              
          });
          
          /**
           * Example Chart
           */         
          function createSerialChart(chartData){
              
           // SERIAL CHART
              chart = new AmCharts.AmSerialChart();
              chart.pathToImages = "/modules/mangoApi/web/js/amcharts/images/";
              chart.dataProvider = chartData;
              chart.categoryField = "date";
              chart.balloon.bulletSize = 5;

              // AXES
              // category
              var categoryAxis = chart.categoryAxis;
              categoryAxis.parseDates = true; // This should be set to true to create labels automatically, but it doesn't work
              categoryAxis.minPeriod = "fff"; // our data is daily, so we set minPeriod to DD
              categoryAxis.dashLength = 1;
              categoryAxis.minorGridEnabled = true;
              categoryAxis.twoLineMode = true;
              categoryAxis.labelFrequency = 10;
              categoryAxis.dateFormats = [{
                  period: 'fff',
                  format: 'JJ:NN:SS'
              }, {
                  period: 'ss',
                  format: 'JJ:NN:SS'
              }, {
                  period: 'mm',
                  format: 'JJ:NN'
              }, {
                  period: 'hh',
                  format: 'JJ:NN'
              }, {
                  period: 'DD',
                  format: 'DD'
              }, {
                  period: 'WW',
                  format: 'DD'
              }, {
                  period: 'MM',
                  format: 'MMM'
              }, {
                  period: 'YYYY',
                  format: 'YYYY'
              }];

              categoryAxis.axisColor = "#DADADA";

              // value
              var valueAxis = new AmCharts.ValueAxis();
              valueAxis.axisAlpha = 0;
              valueAxis.dashLength = 1;
              chart.addValueAxis(valueAxis);

              // GRAPH
              var graph = new AmCharts.AmGraph();
              graph.title = "red line";
              graph.valueField = "value";
              graph.bullet = "round";
              graph.bulletBorderColor = "#FFFFFF";
              graph.bulletBorderThickness = 2;
              graph.bulletBorderAlpha = 1;
              graph.lineThickness = 2;
              graph.lineColor = "#5fb503";
              graph.negativeLineColor = "#efcc26";
              graph.hideBulletsCount = 50; // this makes the chart to hide bullets when there are more than 50 series in selection
              chart.addGraph(graph);

              // CURSOR
              chartCursor = new AmCharts.ChartCursor();
              chartCursor.cursorPosition = "mouse";
              chartCursor.pan = true; // set it to fals if you want the cursor to work in "select" mode
              chart.addChartCursor(chartCursor);

              // SCROLLBAR
              var chartScrollbar = new AmCharts.ChartScrollbar();
              chart.addChartScrollbar(chartScrollbar);

              chart.creditsPosition = "bottom-right";

              // WRITE
              chart.write("chartdiv");
          }          
        </script>
        
    </head>
<body>
        <div id="chartdiv" style="width:100%; height:400px; vertical-align: top;  display: inline-block; padding: 10px;">
        </div>
</body>
</html>