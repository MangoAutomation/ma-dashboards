<!DOCTYPE html>

<html>
    <head>
    	<meta charset="utf-8">
        
    	<!-- In-Line Page Style -->
        <style type="text/css"></style>
    	
    	<title>Serial Chart</title>
        
        <!-- Add the Mango Favicon -->
        <link rel="icon" href="/2.5.0/images/favicon.ico">
        
        <!-- JQuery -->
        <script type="text/javascript" src="/modules/dashboards/web/js/jquery/jquery-1.11.2.js"></script>    	
        <script type="text/javascript" src="/modules/dashboards/web/js/jquery-ui/jquery.datetimepicker.js"></script>       
        <link href="/modules/dashboards/web/js/jquery-ui/jquery.datetimepicker.css" rel="stylesheet">
        
        <!-- Bootstrap -->
        <script src="/modules/dashboards/web/js/bootstrap/js/bootstrap.min.js"></script>
        <link href="/modules/dashboards/web/js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="/modules/dashboards/web/private/css/demoVideoExample.css" rel="stylesheet">
        
        <!-- Charting Library -->
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/amcharts.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/serial.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/gauge.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/pie.js"></script>
    
        <!-- Mango Rest API Helper -->
        <script type="text/javascript" src="/mango-javascript/v1/mangoApi.js"></script>         
            
    	<!-- Mango Templating API -->
        <!-- Display Widgets -->
        <script type="text/javascript" src="/mango-javascript/v1/serialChart.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/barChart.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/statisticsBarChart.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/pieChart.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/statistics.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/gaugeChart.js"></script>
        
        <!-- Data Providers -->
        <script type="text/javascript" src="/mango-javascript/v1/pointValueDataProvider.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/realtimePointValueDataProvider.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/statisticsDataProvider.js"></script>
        
        <!-- Templater Core -->
        <script type="text/javascript" src="/mango-javascript/v1/dataDisplayManager.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/dataPointMatcher.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/dataPointGroup.js"></script>  
        <script type="text/javascript" src="/mango-javascript/v1/pointHierarchyGrouper.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/dashboardTemplater.js"></script>
        
        <!-- Input Widgets -->
        <script type="text/javascript" src="/mango-javascript/v1/dateTimePicker.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/rollupPicker.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/timePeriodTypePicker.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/input.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/select.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/listView.js"></script>
        <script type="text/javascript" src="/mango-javascript/v1/selectPicker.js"></script>
    
        <script type="text/javascript">
       
       //Define Global Variables
       var templater;
       
       $( document ).ready(function(){
           
           //Serial chart for both Temperature and Voltage
           var serialChart = new  SerialChartConfiguration(
                   'serialChart', //Chart DIV id
                   [1], //List of data provider Ids for this chart
                   { //AmChart Mixins
               titles: [{
                   id: "Title-1",
                   size: 15,
                   text: "System History"
               }],
               categoryField: "timestamp",
               graphs: [{
                   title: "Temperature",
                   valueAxis: "temperature-axis",
                   bullet: "square",
                   bulletSize: 6,
                   lineColor: "green",
                   lineThickness: 1,
                   negativeLineColor: "red",
                   type: "smoothedLine",
                   valueField: "temperature"
               },{
                   title: "Voltage",
                   valueAxis: "voltage-axis",
                   bullet: "round",
                   bulletSize: 6,
                   lineColor: "blue",
                   lineThickness: 1,
                   negativeLineColor: "red",
                   type: "smoothedLine",
                   valueField: "voltage"
               }],
               valueAxes: [{
                   id: "temperature-axis",
                   title: "Degrees F",
                   position: "left"
               },{
                   id: "voltage-axis",
                   title: "Volts",
                   position: "right"
               }],
           },{//empty Mango Chart Mixins
           },{//Confuguration Mixins
               //Multi-series chart so create mappings from point to a graph valueField
               dataPointMappings: [{
                       nameEndsWith: 'Temperature',
                       valueField: 'temperature'
                   },{
                       nameEndsWith: 'Voltage',
                       valueField: 'voltage'
                   }]
           });
           
           //Setup the Totals Pie Chart
           var totalsPieChart = new PieChartConfiguration(
                   'totalsPieChart',
                   [2],
                   { //AmChart Mixins
                       valueField: "sum", //Map the value field to the attribute SUM
                       titleField: "name",
                       titles: [{
                           text: "Sums",
                           size: 16
                       }],
                       depth3D: 15,
                       balloonFunction: function(graphDataItem, text){
                           if(typeof graphDataItem.value != 'undefined'){
                               return "<b>" + graphDataItem.title +  "</b><br>" + graphDataItem.value.toFixed(2);
                           }else{
                               return "";
                           }
                       },
                       angle: 30
                      },{  //MangoPieChart Mixins
                          onLoad: function(data, dataPoint){
                        	  //Using the statistics data push one slice onto the pie
                              this.amChart.dataProvider.push({
                            	  sum: data.sum, 
                            	  name: dataPoint.name
                           	  });
                              this.amChart.validateData();   
                          }
                      });
           
           //Setup the Averages Pie Chart
           var averagesPieChart = new PieChartConfiguration(
                   'averagesPieChart',
                   [2],
                   { //AmChart Mixins
                       valueField: "average",
                       titleField: "name",
                       titles: [{
                           text: "Averages",
                           size: 16
                       }],
                       depth3D: 15,
                       balloonFunction: function(graphDataItem, text){
                           if(typeof graphDataItem.value != 'undefined'){
                               return "<b>" + graphDataItem.title +  "</b><br>" + graphDataItem.value.toFixed(2);
                           }else{
                               return "";
                           }
                       },
                       angle: 30
                      },{  //MangoPieChart Mixins
                          onLoad: function(data, dataPoint){
                              this.amChart.dataProvider.push({
                            	  average: data.average, 
                            	  name: dataPoint.name
                              });
                              this.amChart.validateData();   
                          }
                      });
     
           //Setup Point Configurations
           //Setup a match to both the Voltage and Temperature points to use the same Point Value Data Provider with id 1
           var voltagePointValueProvider = new DataPointMatchConfiguration(1, [{matchAttribute: 'name', regex: /Voltage/}], {providerType: 'PointValue'});
           var temperaturePointValueProvider = new DataPointMatchConfiguration(1, [{matchAttribute: 'name', regex: /Temperature/}], {providerType: 'PointValue'});
           
           //Setup a match to both the Voltage and Temperature point to use the same Statistics Data Provider with id 2
           var voltageStatisticsProvider = new DataPointMatchConfiguration(2, [{matchAttribute: 'name', regex: /Voltage/}], {providerType: 'Statistics'});
           var temperatureStatisticsProvider = new DataPointMatchConfiguration(2, [{matchAttribute: 'name', regex: /Temperature/}], {providerType: 'Statistics'});
    
           //Setup Group to match the points in the Point Hierarch folder with path /Target Folder/
           // this will use the Folder name as the group label
           var targetFolderGroup = new DataPointGroupConfiguration({
                   groupBy: 'Folder',
                   labelAttribute: 'name',
                   matchConfigurations: [{
                       matchAttribute: 'path',
                       regex: /Target Folder/
                   }]
               });
             
           
           //Setup Templater
           var templaterConfig = {
                   debug: true,
                   type: 'PointHierarchy',
                   //Display Configurations for this Templater
                   displayConfigurations: [serialChart, totalsPieChart, averagesPieChart],
                   //Point Match Configurations for this Templater
                   pointConfigurations: [voltagePointValueProvider, temperaturePointValueProvider, voltageStatisticsProvider, temperatureStatisticsProvider],
                   //Grouping Configurations for this Templater
                   groupConfigurations: [targetFolderGroup],
                   //Select Input Configuration for this Templater
                   groupSelectConfiguration: new SelectPickerConfiguration('groupsList', {options: [{label: 'Select Group', value: '-1'}]}, {styleClass: "ui-btn"}),
               }
           
           //Create the templater
           templater = new DashboardTemplater(templaterConfig);
           
           //Can optionally perform action when templater is ready by using the Deferred Promise of the Templater
           $.when(templater.deferred.promise).then(function(){ alert('Templater is ready.')});
                
       });// End When page Ready
       
       </script>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
            
                <!-- Sidebar Inputs Section to be populated by the Templater -->
                <div class="col-sm-3 col-md-2 sidebar">
                    <ul class="nav nav-sidebar">
                        <!-- Setup the Group Select to be populated by the Templater -->
                        <li>
                            <select class="form-control" id="groupsList"></select>
                        </li>
                        <!-- Setup the Custom Period Select to be populated by the Templater -->
                        <li>
                            <select class="form-control" id="customPeriodSelect"></select>
                        </li>
                        <!-- Setup the Start Date Picker to be populated by the Templater -->
                        <li>
                            <input class="form-control" id="startDate" placeholder="To Date"/>
                        </li>
                        <!-- Setup the End Date Picker to be populated by the Templater -->
                        <li>
                            <input class="form-control" id="endDate" placeholder="To Date"/>
                        </li>
                        <!-- Setup the Rollup Select to be populated by the Templater -->
                        <li>
                            <select class="form-control" id="rollup"></select>
                        </li>
                        <!-- Setup the Time Period Type Select to be populated by the Templater -->
                        <li>
                            <select class="form-control" id="timePeriodType"></select>
                        </li>
                        <!-- Setup the Time Periods input to be populated by the Templater -->
                        <li>
                            <input class="form-control" id="timePeriod" placeholder="1" type="number" value="1"/>
                        </li>
                    </ul>
                </div>
        
                <!-- Main Panel -->
                <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
                
                    <!-- Page Header -->
                    <div class="page-header">
                        <h1>Mango Javascript API Example</h1>
                        <p class="lead">Basic dashboard to get you familiar with building within the Mango Javascript API.  
                        This page also uses Bootstrap formatting to responsively format the page depending on the screen size.</p>
                        <!-- The templater defaults to using a div with id errors if it exists -->
                        <div id="errors" class="has-error"></div>
                    </div>
                    
                    <!-- Chart Area  -->
                    <div class="row">
                        <div class="col-sm-9 col-md-5">
                            <div  id="totalsPieChart" style="width:100%; height:200px; vertical-align: top;  display: inline-block; padding: 10px;"></div>
                        </div>
                        <div class="col-sm-9 col-md-5">
                            <div  id="averagesPieChart" style="width:100%; height:200px; vertical-align: top;  display: inline-block; padding: 10px;"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-9 col-md-10">
                            <div  id="serialChart" style="width:100%; height:400px; vertical-align: top;  display: inline-block; padding: 10px;"></div>
                        </div>
                    </div>
                </div>
            </div> <!-- End outer row -->    
        </div> <!-- End container Div -->
    </body>
</html>

