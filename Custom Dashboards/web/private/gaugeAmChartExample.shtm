<!DOCTYPE html>
<html>
    <head>
        <title>Gauge AM Chart Example</title>
        
        
        <!-- Page Style -->
        <style type="text/css">
        </style>
        
        <!-- Scripts from Module Directory -->
        <script type="text/javascript" src="/modules/dashboards/web/js/jquery/jquery-1.11.1.js"></script>
        <!-- Charting Library -->
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/amcharts.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/gauge.js"></script>
        <!-- Mango Rest API Helper -->
        <script type="text/javascript" src="/modules/dashboards/web/js/mangoApi.js"></script>         
        <!-- Mango AM Charts Helper -->
        <script type="text/javascript" src="/modules/dashboards/web/js/mangoAmChartsApi.js"></script>         
       
        <script type="text/javascript">
          var gauge1 = new MangoAmGaugeHelper({
              xid: "DP_544063",
              gaugeDivId: "gauge1",
              units: "Degrees F",
              pollPeriodMs: 500,
              jsonConfig: {
                  "type": "gauge",
                  "pathToImages": "http://cdn.amcharts.com/lib/3/images/",
                  "marginBottom": 20,
                  "marginTop": 40,
                  "startDuration": 0,
                  "fontSize": 13,
                  "theme": "dark",
                  "arrows": [
                      {
                          "id": "GaugeArrow-1",
                          "value": 100
                      }
                  ],
                  "axes": [
                      {
                          "axisThickness": 1,
                          "bottomText": "0 km/h",
                          "bottomTextYOffset": -20,
                          "endValue": 220,
                          "id": "GaugeAxis-1",
                          "valueInterval": 10,
                          "bands": [
                              {
                                  "alpha": 0.7,
                                  "color": "#00CC00",
                                  "endValue": 90,
                                  "id": "GaugeBand-1",
                                  "startValue": 0
                              },
                              {
                                  "alpha": 0.7,
                                  "color": "#ffac29",
                                  "endValue": 130,
                                  "id": "GaugeBand-2",
                                  "startValue": 90
                              },
                              {
                                  "alpha": 0.7,
                                  "color": "#ea3838",
                                  "endValue": 220,
                                  "id": "GaugeBand-3",
                                  "innerRadius": "95%",
                                  "startValue": 130
                              }
                          ]
                      }
                  ],
                  "allLabels": [],
                  "balloon": {},
                  "titles": []
              },
          });
          

          /**
           * Update gauge Value
           */
          function updateGauge(){

              mangoRest.pointValues.getLatest(gauge1.xid, 1, function(data, xid){
                 
                  if(data.length > 0){
	                  var value = data[0].value;
	                  gauge1.gauge.arrows[0].setValue(value);
	                  gauge1.gauge.axes[0].setBottomText(value + " " +  gauge1.units);
                  }
                  
              }, function(jqXHR, textStatus, errorThrown, mangoMessage){
                  var msg = "";
                  
                  if(textStatus != null)
                      msg += (textStatus + " ");
                  if(errorThrown != null)
                      msg += (errorThrown + " ");
                  if(mangoMessage != null)
                      msg += (mangoMessage + " ");
                  
                  msg += "\n";
             
                  
                  $("#errors").text(msg);
                  //alert user on fail
                  //alert(errorThrown + " " + mangoMessage);
              });
              
              
          }
          
          
          
          /**
           * Run on page load
           */
          $( document ).ready(function(){
              
              //Hack for now to set the update method
              gauge1.updateGauge = updateGauge;
              
              //Start the gauge updating at the poll period
              gauge1.startGauge();
                            
          });          
        </script>
        
    </head>
<body>
    <div id="gauge1" style="width:100%; height:400px; vertical-align: top;  display: inline-block; padding: 10px;">
    </div>
    
    <!-- Placeholder to log errors -->
    <div id="errors" style="color: red"></div>    
</body>
</html>