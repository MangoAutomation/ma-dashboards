<!DOCTYPE html>

<html>
<head>
	<meta charset="utf-8">
	
	<!-- Page Style -->
    <style type="text/css">
    </style>
	
	
	<title>Inputs</title>
    
    <!-- JQuery -->
    <script type="text/javascript" src="/modules/dashboards/web/js/jquery/jquery-1.11.1.js"></script>    	
       
    <link href="/modules/dashboards/web/js/jquery-ui/jquery.datetimepicker.css" rel="stylesheet">
 
    <script type="text/javascript" src="/modules/dashboards/web/js/jquery-ui/jquery.datetimepicker.js"></script>
    <!-- Charting Library -->
    <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/amcharts.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/serial.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/gauge.js"></script>

    <!-- Mango Rest API Helper -->
    <script type="text/javascript" src="/modules/dashboards/web/js/mangoApi.js"></script>         
        
    <!-- Mango Templating API -->
    <!-- Display Widgets -->
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/serialChart.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/barChart.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/statisticsBarChart.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/pieChart.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/statistics.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/gaugeChart.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/simpleDisplay.js"></script>
    
    
    <!-- Data Providers -->
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/pointValueDataProvider.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/realtimePointValueDataProvider.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/statisticsDataProvider.js"></script>
    <!-- Templater Core -->
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/dataDisplayManager.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/dataPointMatcher.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/dataPointGroup.js"></script>  
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/pointHierarchyGrouper.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/dashboardTemplater.js"></script>
    <!-- Input Widgets -->
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/dateTimePicker.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/rollupPicker.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/timePeriodTypePicker.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/input.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/select.js"></script>
    <script type="text/javascript" src="/modules/dashboards/web/js/mango/listView.js"></script>
    

   <script type="text/javascript">
   
   //Define Global Variables
   var templater1, templater2;
   
   $( document ).ready(function(){
       
       //Setup Display Configurations
       
       var simpleDisplay1 = new SimpleDisplayConfiguration([1], 
               {
                  onClear: function(){
                      $('#display1-count').empty();
                  },
                  onLoad: function(pointValues, dataPoint){
                      $('#display1-count').text(pointValues.length);
                   }
               }); //Just assign data provider ids
       var simpleDisplay2 = new SimpleDisplayConfiguration([1], 
               {
                  onClear: function(){
                      $('#display2-count').empty();
                  },
                  onLoad: function(pointValues, dataPoint){
                      $('#display2-count').text(pointValues.length);
                   }
               }); //Just assign data provider ids
             
       //Setup Point Configurations
       var pointConfigurations = new Array();
       pointConfigurations.push(new DataPointMatchConfiguration(1, {xidEndsWith: 'voltage'}))

       //Setup Groups
       var group = new DataPointGroupConfiguration({
           groupBy: 'Folder',
           labelAttribute: 'name',
           matchConfigurations: [{
               matchAttribute: 'path',
               startsWith: 'Target Folder'
           }]
           });
       
       var groupConfigurations = new Array();
       groupConfigurations.push(group);
       
       //Setup Templater, Defaults to previous 12 Hours
       
       
       templater1 = new DashboardTemplater({
           debug: true,
           type: 'PointHierarchy',
           displayConfigurations: [simpleDisplay1],
           pointConfigurations: pointConfigurations,
           groupConfigurations: groupConfigurations,
           dataProviders: new Array(), //Ensure we have separate providers from templater 2
      });

      var templater2EndDate = new Date();
      var templater2StartDate = new Date(templater2EndDate.getTime() - 1000*60*60); //1 Hour 
      //Configure Templater 2
      templater2 = new DashboardTemplater({
           debug: true,
           type: 'PointHierarchy',
           displayConfigurations: [simpleDisplay2],
           pointConfigurations: pointConfigurations,
           groupConfigurations: groupConfigurations,
           dataProviders: new Array(), //Ensure we have separate providers from templater 1
           
           startDate: templater2StartDate,
           endDate: templater2EndDate,
           
           //Here we reference the functions below to handle the changes and perform custom actions on them
           startDateConfiguration:  new DateTimePickerConfiguration('startDate2', {}, {onChange: startDateChanged}),
           endDateConfiguration: new DateTimePickerConfiguration('endDate2', {}, {onChange: endDateChanged}),
           rollupConfiguration: new RollupConfiguration('rollup2', {}, {onChange: rollupChanged, selected: 'FIRST'}),
           timePeriodTypeConfiguration: new TimePeriodTypeConfiguration('timePeriodType2', {timePeriodTypes: ['SECONDS', 'MINUTES', 'HOURS', 'DAYS', 'WEEKS', 'MONTHS', 'YEARS']}, {onChange: timePeriodTypeChanged, selected: 'MINUTES'}),
           timePeriodConfiguration: new InputConfiguration('timePeriod2', {}, {onChange: timePeriodChanged, defaultValue: 1}),
           
           //Because we are not going to use a Group Selector we need to let the templater to know 
           // not to create the default one.  This is done by passing in a dummy Group Selector that does nothing
           groupSelectConfiguration: {create: function(){}, addItem: function(label, id){}}, //Dummy Configuration that does nothing
           
           
      });       
       
       //Using the Deferred to know when the templater is ready for use, we change to the first group 
      $.when(templater2.deferred).then(function(){
          templater2.groupChanged(0, templater2); //Signal a group change
      });
       
            
   });// End When page Ready
   
   var groupId = 0; //Groups are referenced to thier position in the array in the templater, there is only 1 group and its at position 0
   
   /**
    * What to do when Templater 2's start date is changed
    */
   function startDateChanged(date, $input, templater){
       templater.startDate = date;
       templater.displayManager.clear(); //Clear all data
       templater.displayManager.refresh(null, 
           {
            from: templater.startDate, 
            to: templater.endDate, 
            rollup: templater.rollup, 
            timePeriodType: templater.timePeriodType, 
            timePeriods: templater.timePeriods
           });

   }
   function endDateChanged(date, $input, templater){
       templater.endDate = date;
       templater.displayManager.clear(); //Clear all data
       templater.displayManager.refresh(null, 
          {
           from: templater.startDate, 
           to: templater.endDate, 
           rollup: templater.rollup, 
           timePeriodType: templater.timePeriodType, 
           timePeriods: templater.timePeriods
          });
   }
   
   function rollupChanged(rollup, templater){
       templater.rollup = rollup;
       templater.displayManager.clear(); //Clear all data
       templater.displayManager.refresh(null,
          {
           from: templater.startDate, 
           to: templater.endDate, 
           rollup: templater.rollup, 
           timePeriodType: templater.timePeriodType, 
           timePeriods: templater.timePeriods
          });
       }
   
   function timePeriodTypeChanged(timePeriodType, templater){
       templater.timePeriodType = timePeriodType;
       templater.displayManager.clear(); //Clear all data
       templater.displayManager.refresh(null, 
          {
           from: templater.startDate, 
           to: templater.endDate, 
           rollup: templater.rollup, 
           timePeriodType: templater.timePeriodType, 
           timePeriods: templater.timePeriods
          });
   }
   
   function timePeriodChanged(timePeriods, templater){
       templater.timePeriods = timePeriods;
       templater.displayManager.clear(); //Clear all data
       templater.displayManager.refresh(null, 
          {
           from: templater.startDate, 
           to: templater.endDate, 
           rollup: templater.rollup, 
           timePeriodType: templater.timePeriodType, 
           timePeriods: templater.timePeriods
          });
   }

   </script>





</head>
<body>
    <div id="errors"></div> <!-- The templater defaults to using a div with id errors if it exists -->
    
    <p>This page uses 2 Templaters to show the possible ways to configure inputs to the templater. The templater 
    has 6 Inputs.</p>
    <ul>
        <li>Group Select - The list of Matched Groups</li>
        <li>Start Date - Start date for all rendering. Defaults to 12 Hours ago</li>
        <li>End Date - End date for all rendering. Defaults to now.</li>
        <li>Rollup - The type of rollup used. Defaults to AVERAGE.</li>
        <li>Time Period Type - the time period type to apply to the Rollup. Default to HOURS.</li>
        <li>Time Periods - the number of period types to apply to Rollup</li>
    </ul>
    
    <p>By default the Group Select is the only way to action a refresh of displays.  This can be overriden as seen in example 2.</p>
    <h2>Templater 1 Inputs</h2>
    <select id="groups">
        <option>Select Group</option>
    </select>
    <label for="startDate">Start Date</label>
    <input id="startDate"></input>
    
    <label for="endDate">End Date</label>
    <input id="endDate"></input>
    
    <label for="rollup">Rollup:</label>
    <select id="rollup" ></select>
    
    <label for="timePeriodType">Time Period:</label>
    <select id="timePeriodType" ></select>
    
    <label for="timePeriod">Periods:</label>
    <input id="timePeriod" type="number" value="1"/>
    
    <div id="display1">
        <p>Here is a count of the samples from Templater 1</p>
        <div id="display1-count"></div>
    </div>
    <hr>
    <h2>Templater 2 Inputs</h2>
    
    <label for="startDate2">Start Date</label>
    <input id="startDate2"></input>
    
    <label for="endDate2">End Date</label>
    <input id="endDate2"></input>
    
    <label for="rollup2">Rollup:</label>
    <select id="rollup2" ></select>
    
    <label for="timePeriodType2">Time Period:</label>
    <select id="timePeriodType2" ></select>
    
    <label for="timePeriod2">Periods:</label>
    <input id="timePeriod2" type="number" value="1"/>
    
    
    <div id="display2">
        <p>Here is a count of the samples from Templater 2</p>
        <div id="display2-count"></div>
    </div>
    
</body>
</html>

