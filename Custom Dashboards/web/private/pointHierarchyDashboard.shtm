<!DOCTYPE html>
<html>
    <head>
        <title>Point Hierarchy Dashboard</title>
        
        
        <!-- Page Style -->
        <style type="text/css">
        </style>
        <link href="/modules/dashboards/web/js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="/modules/dashboards/web/js/jquery-ui/jquery.datetimepicker.css" rel="stylesheet">
        
        
        <!-- JQuery and Plugins -->
        <script type="text/javascript" src="/modules/dashboards/web/js/jquery/jquery-1.11.1.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/jquery-ui/jquery-ui.js"></script> <!-- Can use min.js -->
        <script type="text/javascript" src="/modules/dashboards/web/js/jquery-ui/jquery.datetimepicker.js"></script>
        <!-- Charting Library -->
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/amcharts.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/serial.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/pie.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/amcharts/gauge.js"></script>
        
        <!-- Bootstrap -->
        <script src="/modules/dashboards/web/js/bootstrap/js/bootstrap.min.js"></script>
        
        
        <!-- Mango Rest API Helper -->
        <script type="text/javascript" src="/modules/dashboards/web/js/mangoApi.js"></script>         
        
        <!-- Mango AM Charts Helper -->
        <script type="text/javascript" src="/modules/dashboards/web/js/mangoAmChartsApi.js"></script>
        
        <!-- Mango Templating API -->
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/dataDisplayManager.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/serialChart.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/pieChart.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/statistics.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/pointValueDataProvider.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/statisticsDataProvider.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/dataPointMatcher.js"></script>
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/dataPointGroup.js"></script>        
        <script type="text/javascript" src="/modules/dashboards/web/js/mango/pointHierarchyGrouper.js"></script>
        
        
        <!-- JS For this page -->
        <script type="text/javascript">
        $( document ).ready(function(){
            
            //Create a Statistics Data Provider
            var statsDataProvider = new StatisticsDataProvider(1);

            //Create the Display Manager
            var pieChart = new PieChartConfiguration(
                    'chart1',
                    [1],
                    { //AmChart Mixins
                        titles: [{
                            text: "Averages",
                            size: 16
                        }],
                        depth3D: 15,
                        balloonText: "[[title]]<br><span style='font-size:14px'><b>[[value]]</b> ([[percents]]%)</span>",
                        angle: 30
                       },{  //MangoPieChart Mixins
                           onLoad: function(statistics, xid){
                               if(statistics.hasData){
	                               //Find the matching XID if there is one
	                               for(var i=0; i<this.amChart.dataProvider.length; i++){
	                                   if(this.amChart.dataProvider[i].xid == xid){
	                                       this.amChart.dataProvider[i].count = statistics.count;
	                                       this.amChart.validateData();
	                                       return; //Done
	                                   }
	                               }
	                               //We didn't find our set, so add a brand new one
	                               this.amChart.dataProvider.push({count: statistics.count, xid: xid});
	                               this.amChart.validateData();
                               }
                           }
                       });
            
            var displayManager = new DataDisplayManager();
            displayManager.addDisplayConfiguration(pieChart);
            displayManager.registerWithDisplays(statsDataProvider);
            
            /**
             * Called on match of data point
             */
            function onMatch(dataPointConfiguration){
                   
            }
            var pointMatcher = new DataPointMatcher([new DataPointMatcher(1)], onMatch);
            



            
            /**
             * Helper Function to show error messages
             */
            function showError(jqXHR, textStatus, errorThrown, mangoMessage){
                
                var msg = "";
                if(textStatus != null)
                    msg += (textStatus + " ");
                if(errorThrown != null)
                    msg += (errorThrown + " ");
                if(mangoMessage != null)
                    msg += (mangoMessage + " ");
                msg += "\n";
                $("#errors").text(msg);
            }
        });
        </script>
        
        
    </head>
    <body>
    <p>This page will create a Chart from a template that matches every point in Mango.  
    </p>
    
    <!-- Placeholder to log errors -->
    <div id="errors" style="color: red"></div> 
    
    <hr></hr>
    <!-- The Pie Chart -->
    <div id="chart1" style='width:100%; height:400px; vertical-align: top;  display: inline-block; padding: 10px;'></div>

    </body>
</html>