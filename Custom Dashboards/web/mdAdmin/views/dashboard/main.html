<div layout="row" flex>
  <md-sidenav class="site-sidenav md-sidenav-left md-whiteframe-z2" md-component-id="left" hide-print
        md-is-locked-open="navLockedOpen" md-swipe-left="closeMenu()" class="navigation-menu">
    <md-toolbar class="md-tall md-primary md-hue-1 dashboard-sidebar-header md-whiteframe-glow-z1">
      <ma-now update-interval="1 MINUTES" output="currentTime" time-zone="{{user.getTimezone()}}"></ma-now>
      <div flex layout="row">
        <img src="/modules/dashboards/web/img/logo.svg" ma-tr="header.dashboards.v3.dox.heading">
        <div flex layout="column" layout-align="start end" class="dashboard-user-datetime">
          <span ng-bind="currentTime.format('LT')" class="dashboard-user-time"></span>
          <span ng-bind="currentTime.format('ddd ll')" class="dashboard-user-date"></span>
          <span ng-bind="currentTime.format('z')" class="dashboard-user-date"></span>
        </div>
      </div>
      <span ng-bind="user.username"></span>
      <span class="email" ng-bind="user.email"></span>
    </md-toolbar>

    <md-content flex role="navigation" md-colors="{background: 'background-A100'}">
      <json-store-menu user="user"></json-store-menu>
    </md-content>
  </md-sidenav>

  <div layout="column" tabIndex="-1" flex class="main-page-area">
    <md-toolbar md-theme="mangoDark" class="md-whiteframe-glow-z1 dashboard-main-toolbar" role="toolbar">

      <div class="md-toolbar-tools dashboard-toolbar-tools" tabIndex="-1">
        <md-button id="menu-button" class="md-icon-button" ng-click="toggleMenu()" aria-label="Toggle Menu"> <md-icon class="md-light">menu</md-icon>
        </md-button>
        <div layout="row" flex class="fill-height">
          <h2 class="md-toolbar-item dashboard-breadcrumb" ng-class="{'gt-sm': $mdMedia('gt-sm')}">
            <span ng-repeat="crumb in crumbs track by $index" ng-class="{'hide-xs': !$last}">
                <span ma-tr="{{crumb.maTr}}" ng-bind="crumb.text"></span>
                <span ng-if="!$last">
                    <md-icon>chevron_right</md-icon>
                </span>
            </span>
          </h2>
          
          <span flex></span>
          <!-- use up the empty space -->

          <div class="md-toolbar-item dashboard-tools" layout="row" layout-align="start center">
            <ma-active-event-icons></ma-active-event-icons>
            <md-button class="md-icon-button" ng-if="errors.length">
                <md-tooltip md-autohide>REST API errors</md-tooltip>
                <a ui-sref="dashboard.apiErrors"><md-icon>warning</md-icon></a>
            </md-button>
            <!--
            <md-button class="md-icon-button" aria-label="Mango events" ng-href="/events.shtm" target="_blank">
                <md-tooltip md-autohide>Mango Events</md-tooltip>
                <md-icon>alarm</md-icon>
            </md-button>
            -->
            
            <div ng-if="mdAdmin.stateParams.dateBar">
              <md-input-container class="date-preset">
                <ma-date-range-picker from="mdAdmin.dateBar.from" to="mdAdmin.dateBar.to"
                  preset="LAST_1_DAYS" update-interval="1 minutes" aria-label="{{'dashboards.v3.app.datePreset' | tr}}"></ma-date-range-picker>
              </md-input-container>
              <md-button class="md-icon-button md-hue-1" ng-click="mdAdmin.dateBar.expanded = !mdAdmin.dateBar.expanded"
                aria-label="{{'dashboards.v3.app.moreDateSettings' | tr}}"
                ng-class="{'md-accent': mdAdmin.dateBar.expanded}">
                  <md-icon>date_range</md-icon>
              </md-button>
            </div>
          
            <md-menu md-position-mode="target-right target">
              <md-button aria-label="User menu" class="md-icon-button" ng-click="$mdOpenMenu($event)">
                <md-icon md-menu-origin>more_vert</md-icon>
              </md-button>
              <md-menu-content width="4">
                <!--
                <md-menu-item>
                  <md-button aria-label="User profile" ng-href="/users.shtm" target="_blank">
                    <div layout="row" flex layout-align="start center" layout-fill>
                      <p flex>{{user.username}}</p>
                      <md-icon md-menu-align-target style="margin: auto 3px auto 0;">person</md-icon>
                    </div>
                  </md-button>
                </md-menu-item>
                -->
                <md-menu-item ng-if="user.hasPermission('edit-menus')">
                  <md-button aria-label="{{'dashboards.v3.app.editMenu'|tr}}" ui-sref="dashboard.settings.editMenu">
                    <div layout="row" flex layout-align="start center" layout-fill>
                      <p flex ma-tr="dashboards.v3.app.editMenu">Edit menu</p>
                      <md-icon md-menu-align-target style="margin: auto 3px auto 0;">toc</md-icon>
                    </div>
                  </md-button>
                </md-menu-item>
                <md-menu-item ng-if="user.hasPermission('superadmin')">
                  <md-button aria-label="{{'header.systemSettings'|tr}}" ui-sref="dashboard.settings.systemSettings">
                    <div layout="row" flex layout-align="start center" layout-fill>
                      <p flex ma-tr="header.systemSettings">System settings</p>
                      <md-icon md-menu-align-target style="margin: auto 3px auto 0;">settings</md-icon>
                    </div>
                  </md-button>
                </md-menu-item>
                <md-menu-item>
                  <md-button aria-label="{{'header.logout'|tr}}" ui-sref="logout">
                    <div layout="row" flex layout-align="start center" layout-fill>
                      <p flex ma-tr="header.logout">Logout</p>
                      <md-icon md-menu-align-target style="margin: auto 3px auto 0;">power_settings_new</md-icon>
                    </div>
                  </md-button>
                </md-menu-item>
              </md-menu-content>
            </md-menu>
          </div>
        </div>
      </div>

    </md-toolbar>
    
    <md-toolbar md-theme="mangoDark" class="md-hue-2 date-bar" ng-if="mdAdmin.stateParams.dateBar" ng-show="mdAdmin.dateBar.expanded">
      <div class="md-toolbar-tools">
        <date-bar flex></date-bar>
      </div>
    </md-toolbar>

    <md-content md-scroll-y layout="column" flex class="main-content">
      <div ui-view flex="noshrink" layout="column" class="dashboard-main-view" role="main"></div>
      
      <div class="dashboard-footer">
          &copy;2016 <a href="http://infiniteautomation.com/" target="_blank">Infinite Automation Systems Inc</a>. <span ma-tr="footer.rightsReserved"></span>
        </div>
    </md-content>
  </div>
</div>