<div flex layout ng-form="$ctrl.form">
  <div layout flex="65" flex-gt-sm layout-align="start start" layout-wrap>
    <div flex="100" flex-gt-sm="50" layout layout-align="start center" ng-if="$ctrl.stateParams.dateBar.rollupControls">
      <md-input-container flex="30">
        <label>Rollup Type</label>
        <md-select name="rollupType" ng-model="$ctrl.params.rollupType">
          <md-option value="MINIMUM">Minimum</md-option>
          <md-option value="MAXIMUM">Maximum</md-option>
          <md-option value="AVERAGE">Average</md-option>
          <md-option value="DELTA">Delta</md-option>
          <md-option value="NONE">None</md-option>
        </md-select>
      </md-input-container>
      <md-input-container class="no-errors-spacer" flex="20">
        <label>Rollup</label>
        <input name="rollupIntervals" ng-model="$ctrl.params.rollupIntervals" type="number" min="1" step="1" ng-disabled="$ctrl.params.rollupType === 'NONE' || $ctrl.params.autoRollup" ng-change="$ctrl.updateIntervalFromRollupInterval()">
      </md-input-container>
      <md-input-container flex="30">
        <label>Rollup</label>
        <md-select name="rollupIntervalPeriod" ng-model="$ctrl.params.rollupIntervalPeriod" ng-disabled="$ctrl.params.rollupType=='NONE' || $ctrl.params.autoRollup" ng-change="$ctrl.updateIntervalFromRollupInterval()">
          <md-option value="SECONDS">Seconds</md-option>
          <md-option value="MINUTES">Minutes</md-option>
          <md-option value="HOURS">Hours</md-option>
          <md-option value="DAYS">Days</md-option>
          <md-option value="WEEKS">Weeks</md-option>
          <md-option value="MONTHS">Months</md-option>
          <md-option value="YEARS">Years</md-option>
        </md-select>
      </md-input-container>
      <md-checkbox name="autoRollup" flex="20" class="checkbox-top-label checkbox-centered" ng-model="$ctrl.params.autoRollup"
        ng-disabled="$ctrl.params.rollupType === 'NONE'" ng-change="$ctrl.calcAutoRollup()">Auto rollup</md-checkbox>
    </div>

    <div flex="100" flex-gt-sm="50" layout layout-align="start center" ng-if="$ctrl.params.preset">
      <md-input-container class="no-errors-spacer" flex="20">
        <label>Update</label>
        <input name="updateIntervals" ng-model="$ctrl.params.updateIntervals" type="number" min="1" step="1" ng-disabled="!$ctrl.params.autoUpdate" ng-change="$ctrl.calcUpdateIntervalString()">
      </md-input-container>
      <md-input-container flex="40">
        <label>Update</label>
        <md-select name="updateIntervalPeriod" ng-model="$ctrl.params.updateIntervalPeriod" ng-disabled="!$ctrl.params.autoUpdate" ng-change="$ctrl.calcUpdateIntervalString()">
          <md-option value="SECONDS">Seconds</md-option>
          <md-option value="MINUTES">Minutes</md-option>
          <md-option value="HOURS">Hours</md-option>
          <md-option value="DAYS">Days</md-option>
          <md-option value="WEEKS">Weeks</md-option>
          <md-option value="MONTHS">Months</md-option>
          <md-option value="YEARS">Years</md-option>
        </md-select>
      </md-input-container>
      <md-checkbox name="autoUpdate" flex="20" class="checkbox-top-label checkbox-centered" ng-model="$ctrl.params.autoUpdate" ng-change="$ctrl.calcUpdateIntervalString()">Auto update</md-checkbox>
    </div>
  </div>

  <div layout flex="35" flex-gt-sm layout-align="start center" layout-wrap class="date-bar-date-pickers">
    <div flex="100" flex-gt-sm="50" layout layout-align="start center">
      <md-input-container flex="50" class="no-errors-spacer">
        <label>From date</label>
        <ma-date-picker name="fromDate" ng-model="$ctrl.params.from" mode="date"></ma-date-picker>
      </md-input-container>
      <md-input-container flex="50" class="no-errors-spacer">
        <label>From time</label>
        <ma-date-picker name="fromTime" ng-model="$ctrl.params.from" mode="time"></ma-date-picker>
      </md-input-container>
    </div>

    <div flex="100" flex-gt-sm="50" layout layout-align="start center">
      <md-input-container flex="50" class="no-errors-spacer">
        <label>To date</label>
        <ma-date-picker name="toDate" ng-model="$ctrl.params.to" mode="date"></ma-date-picker>
      </md-input-container>
      <md-input-container flex="50" class="no-errors-spacer">
        <label>To time</label>
        <ma-date-picker name="toTime" ng-model="$ctrl.params.to" mode="time"></ma-date-picker>
      </md-input-container>
    </div>
  </div>

  <div flex="noshrink" layout layout-align="end center">
    <md-button class="md-icon-button" ng-click="$ctrl.onRefresh({'$event': $event})" aria-label="{{'common.refresh' | tr}}" ng-disabled="!$ctrl.params.preset">
      <md-icon>refresh</md-icon>
    </md-button>
  </div>
  
</div>