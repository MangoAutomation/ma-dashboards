<md-toolbar class="md-whiteframe-1dp md-hue-3">
    <div class="md-toolbar-tools" ng-class="{'mobile': $mdMedia('xs')}">
      <span>Chart &amp; Compare</span>
      <div flex></div>
      <md-button class="md-raised" ng-click="points=[]; stats=[]; addChecked=[]; graphOptions=[];">Clear</md-button>
    </div>
</md-toolbar>

<div layout="row">
    <md-tabs md-selected="currentTab" md-stretch-tabs="auto" flex="40">
        <md-tab id="tab1">CHART</md-tab>
        <md-tab id="tab2">STATS</md-tab>
    </md-tabs>
    <span flex></span>
    <md-input-container  flex="10" flex-xs="30">
        <label>Chart Type</label>
        <md-select ng-model="chartType" ng-init="chartType='smoothedLine'" aria-label="Chart Type">
            <md-option value="smoothedLine">
                Smooth
            </md-option>
            <md-option value="line">
                Line
            </md-option>
            <md-option value="step">
                Step
            </md-option>
            <md-option value="column">
                Bar
            </md-option>
            <md-option value="stacked">
                Stacked
            </md-option>
            <md-option value="area">
                Area
            </md-option>
        </md-select>
    </md-input-container>
</div>

<md-tabs md-dynamic-height md-swipe-content md-selected="currentTab" class="noTabPanel">
    <md-tab label="Chart">
        <ma-point-values points="points" values="chartValues" from="dateBar.from" to="dateBar.to" rollup="{{dateBar.rollupType}}" rollup-interval="{{dateBar.rollupIntervals}} {{dateBar.rollupIntervalPeriod}}">
        </ma-point-values>
        <div class="chart-content" ng-if="points.length">
            <ma-serial-chart ng-if="chartType!='stacked' && chartType!='area'" default-balloon-text="[[title]]: [[value]]" style="width: 100%; height:100%;" points="points" values="chartValues" default-type="{{chartType}}" stack-type="none" legend="true" balloon="true" export="true" graph-options="graphOptions" options="{valueAxes:[{axisColor:axisColors.leftAxisColor, color:axisColors.leftAxisColor}, {axisColor:axisColors.rightAxisColor, color:axisColors.rightAxisColor}, {axisColor:axisColors.left2AxisColor, color:axisColors.left2AxisColor}, {axisColor:axisColors.right2AxisColor, color:axisColors.right2AxisColor}]}">
            </ma-serial-chart>
            <ma-serial-chart ng-if="chartType=='stacked'" default-balloon-text="[[title]]: [[value]]" style="width: 100%; height:100%;" points="points" values="chartValues" default-type="column" stack-type="regular" legend="true" balloon="true" export="true" graph-options="graphOptions" >
            </ma-serial-chart>
            <ma-serial-chart ng-if="chartType=='area'" default-balloon-text="[[title]]: [[value]]" style="width: 100%; height:100%;" points="points" values="chartValues" default-type="smoothedLine" stack-type="regular" legend="true" balloon="true" export="true" graph-options="graphOptions" >
            </ma-serial-chart>
        </div>
        <div layout="row" layout-wrap layout-margin>
            <md-input-container flex="30">
                <md-radio-group ng-model="selectedAxis" ng-init="selectedAxis='left'" layout="row" layout-align="start center">
                    <md-radio-button value="left">Left</md-radio-button>
                    <md-radio-button value="right">Right</md-radio-button>
                    <md-radio-button value="left-2">Far Left</md-radio-button>
                    <md-radio-button value="right-2">Far Right</md-radio-button>
                </md-radio-group>
            </md-input-container>
            <md-input-container flex="10">
                <md-checkbox ng-model="assignColors" ng-init="assignColors=false">
                Pick Colors
                </md-checkbox>
            </md-input-container>
            <md-input-container flex="10" ng-show="assignColors">
                <label>Next Line Color</label>
                <input type="color" ng-model="selectedColor" ng-init="selectedColor='#C2185B'" ng-disabled="!assignColors">
            </md-input-container>
            <md-input-container  flex="10" ng-show="assignColors">
                <label>Left Axis</label>
                <input type="color" ng-model="axisColors.leftAxisColor" ng-init="axisColors.leftAxisColor='#000000'" ng-disabled="!assignColors">
            </md-input-container>
            <md-input-container  flex="10" ng-show="assignColors">
                <label>Right Axis</label>
                <input type="color" ng-model="axisColors.rightAxisColor" ng-init="axisColors.rightAxisColor='#000000'" ng-disabled="!assignColors">
            </md-input-container>
            <md-input-container  flex="10" ng-show="assignColors">
                <label>Outer Left Axis</label>
                <input type="color" ng-model="axisColors.left2AxisColor" ng-init="axisColors.left2AxisColor='#000000'" ng-disabled="!assignColors">
            </md-input-container>
            <md-input-container  flex="10" ng-show="assignColors">
                <label>Outer Right Axis</label>
                <input type="color" ng-model="axisColors.right2AxisColor" ng-init="axisColors.right2AxisColor='#000000'" ng-disabled="!assignColors">
            </md-input-container>
        </div>
    </md-tab>

    <md-tab label="Statistics">
        <md-table-container>
            <div ng-repeat="point in points" style="display:none;">
                <ma-get-point-value point-xid="{{point.xid}}" point="liveValue">
                </ma-get-point-value>
                <ma-point-statistics point="point" from="dateBar.from" to="dateBar.to" statistics="stats"></ma-point-statistics>
                {{ $parent.stats[$index].name = point.name }} 
                {{ $parent.stats[$index].device = point.deviceName }} 
                {{ $parent.stats[$index].suffix = liveValue.textRenderer.suffix }}
                {{ $parent.stats[$index].avg = parseFloat(stats.average.value) }} 
                {{ $parent.stats[$index].min = parseFloat(stats.minimum.value) }} 
                {{ $parent.stats[$index].max = parseFloat(stats.maximum.value) }}
                {{ $parent.stats[$index].sum = parseFloat(stats.sum.value) }}
                {{ $parent.stats[$index].first = parseFloat(stats.first.value) }}
                {{ $parent.stats[$index].last = parseFloat(stats.last.value) }}
                {{ $parent.stats[$index].count = stats.count }}
            </div>
            <table md-table ng-class="{'desktop': $mdMedia('gt-sm')}">
                <thead md-head md-order="tableOrder">
                    <tr>
                        <th md-column md-order-by="device">Device</th>
                        <th md-column md-order-by="name">Name</th>
                        <th md-column md-numeric md-order-by="avg">Avg</th>
                        <th md-column md-numeric md-order-by="max">Max</th>
                        <th md-column md-numeric md-order-by="min">Min</th>
                        <th md-column md-numeric md-order-by="sum">Sum</th>
                        <th md-column md-numeric md-order-by="first">First</th>
                        <th md-column md-numeric md-order-by="last">Last</th>
                        <th md-column md-numeric md-order-by="count">Count</th>
                    </tr>
                </thead>
                <tbody md-body ng-init="tableOrder='device'">
                    <tr md-row ng-repeat="point in stats | orderBy: tableOrder">
                        <td md-cell>{{point.device}}</td>
                        <td md-cell>{{point.name}}</td>
                        <td md-cell>{{point.avg | noNaN:point.suffix }}</td>
                        <td md-cell>{{point.max | noNaN:point.suffix }}</td>
                        <td md-cell>{{point.min | noNaN:point.suffix }}</td>
                        <td md-cell>{{point.sum | noNaN:point.suffix }}</td>
                        <td md-cell>{{point.first | noNaN:point.suffix }}</td>
                        <td md-cell>{{point.last | noNaN:point.suffix }}</td>
                        <td md-cell>{{point.count}}</td>
                    </tr>
                </tbody>
            </table>
        </md-table-container>
    </md-tab>
</md-tabs>